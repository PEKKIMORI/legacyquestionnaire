# Google Authentication Setup for Minerva University

## Overview
This document describes the Google OAuth authentication implementation that restricts access to only Minerva University email addresses (@minerva.edu and @uni.minerva.edu).

## Implementation Details

### 1. Firebase Configuration (`firebase.ts`)
- Added Google Authentication provider
- Configured domain restriction to `minerva.edu`
- Exported `auth` and `googleProvider` instances

### 2. Login Form Updates (`LoginForm.tsx`)
- Added Google Sign-In button with official Google branding
- Implemented email domain validation for both regular and Google auth
- Added error handling for unauthorized domains
- Users are automatically signed out if they use non-Minerva emails

### 3. Email Domain Validation
The system validates that users can only access with:
- `@minerva.edu` emails
- `@uni.minerva.edu` emails

## Firebase Console Setup Required

To complete the Google authentication setup, you need to configure the following in your Firebase Console:

### 1. Enable Google Authentication
1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Select your project: `legacyquestionnaire-minerva`
3. Navigate to **Authentication** > **Sign-in method**
4. Click on **Google** provider
5. Enable the Google sign-in method
6. Add your OAuth 2.0 client IDs:
   - **Web client ID**: (Auto-generated by Firebase)
   - **Web client secret**: (Auto-generated by Firebase)

### 2. Configure Authorized Domains
In the Authentication settings, make sure these domains are authorized:
- `localhost` (for development)
- Your production domain (e.g., `your-app.vercel.app`)

### 3. Google Cloud Console Setup
Firebase will automatically create a Google Cloud project, but you may need to:
1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Navigate to **APIs & Services** > **Credentials**
3. Find your OAuth 2.0 client ID
4. Add authorized redirect URIs:
   - `http://localhost:3001/__/auth/handler` (for development)
   - `https://your-domain.com/__/auth/handler` (for production)

## Security Features

### Domain Restriction
- The Google provider is configured with `hd: 'minerva.edu'` parameter
- Additional client-side validation checks both `@minerva.edu` and `@uni.minerva.edu`
- Users with non-Minerva emails are automatically signed out

### Error Handling
- Clear error messages for unauthorized domains
- Fallback authentication with email/password still available
- Graceful handling of authentication failures

## User Experience

### Login Flow
1. Users see both email/password form and Google Sign-In button
2. Clicking "Continue with Google" opens Google's OAuth popup
3. If user selects non-Minerva email, they're signed out with error message
4. Successful Minerva email authentication redirects to questions page

### Visual Design
- Google Sign-In button follows Google's branding guidelines
- Proper spacing and visual hierarchy
- Responsive design for mobile and desktop
- Error states with clear messaging

## Testing

### Development Testing
1. Run `npm run dev`
2. Navigate to `http://localhost:3001`
3. Test both email/password and Google authentication
4. Verify domain restriction works correctly

### Production Deployment
Before deploying to production:
1. Update Firebase authorized domains
2. Configure production OAuth redirect URIs
3. Test on production domain
4. Monitor Firebase Authentication logs

## Troubleshooting

### Common Issues
1. **"This app isn't verified" warning**: Normal for development, can be bypassed
2. **Redirect URI mismatch**: Check Google Cloud Console authorized URIs
3. **Domain restriction not working**: Verify `hd` parameter and client-side validation

### Debug Tips
- Check browser console for authentication errors
- Monitor Firebase Authentication logs
- Test with different email domains to verify restrictions
- Ensure popup blockers aren't interfering

## Security Notes

- Never commit Firebase config with sensitive keys to public repositories
- Regularly review Firebase security rules
- Monitor authentication logs for suspicious activity
- Consider implementing additional security measures for production use
